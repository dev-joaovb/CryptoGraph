<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Crypto - Tempo Real</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-bg: #0d1421;
            --secondary-bg: #1a2332;
            --accent-color: #f7931a;
            --text-primary: #ffffff;
            --text-secondary: #8fa8b2;
            --success-color: #00d4aa;
            --danger-color: #ff6b6b;
        }

        body {
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: rgba(26, 35, 50, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .navbar-brand {
            color: var(--accent-color) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .crypto-card {
            background: linear-gradient(145deg, rgba(26, 35, 50, 0.8), rgba(13, 20, 33, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            margin-bottom: 20px;
            color: #8fa8b2;
        }

        .crypto-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.2);
        }

        .price-display {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: #8fa8b2;
        }

        .price-change {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--danger-color);
        }

        .btn-group .btn {
            background: rgba(26, 35, 50, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .btn-group .btn:hover,
        .btn-group .btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--primary-bg);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            cursor: pointer;
        }

        .chart-container:hover {
            opacity: 0.9;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--text-secondary);
        }

        .crypto-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .last-update {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-align: center;
            margin-top: 10px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success-color);
            display: inline-block;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls-section {
            background: rgba(26, 35, 50, 0.6);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .select-crypto {
            background: rgba(13, 20, 33, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            border-radius: 8px;
        }

        .select-crypto:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(247, 147, 26, 0.25);
        }

        /* Modal Styles */
        .chart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .chart-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(26, 35, 50, 0.95), rgba(13, 20, 33, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            width: 95%;
            max-width: 1200px;
            height: 80vh;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger-color);
            transform: rotate(90deg);
        }

        .modal-chart-container {
            height: calc(100% - 120px);
            position: relative;
        }

        .expand-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(247, 147, 26, 0.2);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--accent-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }

        .expand-icon:hover {
            background: rgba(247, 147, 26, 0.4);
            transform: scale(1.1);
        }

        .time-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .time-controls label {
            color: var(--text-secondary);
            font-weight: 500;
            margin-right: 10px;
        }

        .chart-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .chart-info h3 {
            color: var(--text-primary);
            margin: 0;
        }

        .chart-info .crypto-symbol {
            background: var(--accent-color);
            color: var(--primary-bg);
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* Estilos para o conversor */
        .converter-section {
            background: rgba(26, 35, 50, 0.6);
            border-radius: 10px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .converter-card {
            background: linear-gradient(145deg, rgba(26, 35, 50, 0.8), rgba(13, 20, 33, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .converter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(247, 147, 26, 0.1);
        }

        .converter-input {
            background: rgba(13, 20, 33, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .converter-input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(247, 147, 26, 0.25);
            background: rgba(13, 20, 33, 0.9);
            color: var(--text-primary);
        }

        .converter-select {
            background: rgba(13, 20, 33, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 12px;
        }

        .converter-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(247, 147, 26, 0.25);
            background: rgba(13, 20, 33, 0.9);
            color: var(--text-primary);
        }

        .converter-result {
            background: rgba(247, 147, 26, 0.1);
            border: 1px solid rgba(247, 147, 26, 0.3);
            border-radius: 10px;
            padding: 15px;
            color: var(--text-primary);
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swap-button {
            background: var(--accent-color);
            border: none;
            color: var(--primary-bg);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .swap-button:hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 5px 15px rgba(247, 147, 26, 0.3);
        }

        .satoshi-info {
            background: rgba(247, 147, 26, 0.05);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-top: 10px;
        }

        .satoshi-value {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .converter-title {
            color: var(--accent-color);
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fab fa-bitcoin"></i> CryptoDash
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <span class="status-indicator"></span>
                    Ao vivo
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="controls-section">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <label class="form-label">Selecionar Criptomoeda:</label>
                    <select id="cryptoSelector" class="form-select select-crypto">
                        <option value="bitcoin">Bitcoin (BTC)</option>
                        <option value="ethereum">Ethereum (ETH)</option>
                        <option value="solana">Solana (SOL)</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Moeda:</label>
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn active" data-currency="usd">USD</button>
                        <button type="button" class="btn" data-currency="eur">EUR</button>
                        <button type="button" class="btn" data-currency="brl">BRL</button>
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Período:</label>
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn" data-period="0.5">12H</button>
                        <button type="button" class="btn active" data-period="1">1D</button>
                        <button type="button" class="btn" data-period="7">7D</button>
                        <button type="button" class="btn" data-period="30">30D</button>
                    </div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Intervalo:</label>
                    <div class="btn-group w-100" role="group">
                        <button type="button" class="btn active" data-interval="hourly">Horas</button>
                        <button type="button" class="btn" data-interval="daily">Dias</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="converter-section">
            <h3 class="converter-title">
                <i class="fas fa-exchange-alt"></i> Conversor de Criptomoedas
            </h3>
            
            <div class="row">
                <div class="col-lg-6">
                    <div class="converter-card">
                        <h5 class="mb-3"><i class="fas fa-coins"></i> Conversor Geral</h5>
                        <div class="row">
                            <div class="col-md-5">
                                <label class="form-label">De:</label>
                                <div class="row g-2">
                                    <div class="col-7">
                                        <input type="number" 
                                            id="fromAmount" 
                                            class="form-control converter-input" 
                                            placeholder="0.00" 
                                            step="any">
                                    </div>
                                    <div class="col-5">
                                        <select id="fromCurrency" class="form-select converter-select">
                                            <option value="usd">USD</option>
                                            <option value="eur">EUR</option>
                                            <option value="brl">BRL</option>
                                            <option value="bitcoin">BTC</option>
                                            <option value="ethereum">ETH</option>
                                            <option value="solana">SOL</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-2 d-flex align-items-end justify-content-center">
                                <button class="swap-button" onclick="swapCurrencies()" title="Trocar moedas">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                            </div>
                            
                            <div class="col-md-5">
                                <label class="form-label">Para:</label>
                                <div class="row g-2">
                                    <div class="col-5">
                                        <select id="toCurrency" class="form-select converter-select">
                                            <option value="bitcoin">BTC</option>
                                            <option value="ethereum">ETH</option>
                                            <option value="solana">SOL</option>
                                            <option value="usd">USD</option>
                                            <option value="eur">EUR</option>
                                            <option value="brl">BRL</option>
                                        </select>
                                    </div>
                                    <div class="col-7">
                                        <div id="convertedAmount" class="converter-result">
                                            Digite um valor
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="converter-card">
                        <h5 class="mb-3"><i class="fab fa-bitcoin"></i> Conversor Satoshi</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Bitcoin (BTC):</label>
                                <input type="number" 
                                    id="btcAmount" 
                                    class="form-control converter-input" 
                                    placeholder="0.00000000" 
                                    step="0.00000001">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Satoshis:</label>
                                <input type="number" 
                                    id="satoshiAmount" 
                                    class="form-control converter-input" 
                                    placeholder="0" 
                                    step="1">
                            </div>
                        </div>
                        
                        <div class="satoshi-info mt-3">
                            <div class="row">
                                <div class="col-4">
                                    <strong>1 Satoshi em:</strong>
                                </div>
                                <div class="col-8">
                                    <div id="satoshiValues" class="satoshi-value">
                                        Carregando valores...
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <div class="converter-result" id="satoshiResult">
                                Digite valores para conversão
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="crypto-card card h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <img id="currentCryptoIcon" class="crypto-icon" src="icons/bitcoin-btc-logo.png" alt="">
                            <div>
                                <h5 id="currentCryptoName" class="card-title mb-0">Bitcoin</h5>
                                <small class="text-light" id="currentCryptoSymbol">BTC</small>
                            </div>
                        </div>
                        <div id="currentPrice" class="price-display">$0.00</div>
                        <div id="priceChange" class="price-change">0.00%</div>
                        <hr>
                        <div class="row text-center">
                            <div class="col-6">
                                <small class="text-light">24h Volume</small>
                                <div id="volume24h">$0</div>
                            </div>
                            <div class="col-6">
                                <small class="text-light">Market Cap</small>
                                <div id="marketCap">$0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="crypto-card card h-100">
                    <div class="card-body position-relative">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title">Gráfico de Preços</h5>
                            <div id="chartLoading" class="loading" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span class="ms-2">Carregando...</span>
                            </div>
                        </div>
                        <button class="expand-icon" onclick="openChartModal()" title="Expandir gráfico">
                            <i class="fas fa-expand"></i>
                        </button>
                        <div class="chart-container" onclick="openChartModal()">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-4">
                <div class="crypto-card card">
                    <div class="card-body text-center">
                        <img src="icons/bitcoin-btc-logo.png" class="crypto-icon" alt="Bitcoin">
                        <h6>Bitcoin</h6>
                        <div id="btcPrice" class="price-display">$0.00</div>
                        <div id="btcChange" class="price-change">0.00%</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="crypto-card card">
                    <div class="card-body text-center">
                        <img src="icons/ethereum-eth-logo.png" class="crypto-icon" alt="Ethereum">
                        <h6>Ethereum</h6>
                        <div id="ethPrice" class="price-display">$0.00</div>
                        <div id="ethChange" class="price-change">0.00%</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="crypto-card card">
                    <div class="card-body text-center">
                        <img src="icons/solana-sol-logo.png" class="crypto-icon" alt="Solana">
                        <h6>Solana</h6>
                        <div id="solPrice" class="price-display">$0.00</div>
                        <div id="solChange" class="price-change">0.00%</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="last-update">
            <i class="fas fa-clock"></i>
            Última atualização: <span id="lastUpdate">-</span>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chartModal" class="chart-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeChartModal()">×</button>
            <div class="modal-header">
                <div class="chart-info">
                    <img id="modalCryptoIcon" class="crypto-icon" src="icons/bitcoin-btc-logo.png" alt="">
                    <h3 id="modalCryptoName">Bitcoin</h3>
                    <span id="modalCryptoSymbol" class="crypto-symbol">BTC</span>
                    <div id="modalCurrentPrice" class="price-display" style="font-size: 1.5rem; margin: 0;">$0.00</div>
                </div>
            </div>
            <div class="time-controls">
                <label>Controles rápidos:</label>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm" onclick="setModalPeriod(0.5)">12H</button>
                    <button type="button" class="btn btn-sm active" onclick="setModalPeriod(1)">1D</button>
                    <button type="button" class="btn btn-sm" onclick="setModalPeriod(7)">7D</button>
                    <button type="button" class="btn btn-sm" onclick="setModalPeriod(30)">30D</button>
                </div>
                <div class="btn-group ms-3" role="group">
                    <button type="button" class="btn btn-sm active" onclick="setModalInterval('hourly')">Horas</button>
                    <button type="button" class="btn btn-sm" onclick="setModalInterval('daily')">Dias</button>
                </div>
            </div>
            <div class="modal-chart-container">
                <canvas id="modalPriceChart"></canvas>
                <div id="modalChartLoading" class="loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span class="ms-2">Carregando...</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        class CryptoDashboard {
            constructor() {
                this.currentCurrency = 'usd';
                this.currentPeriod = 1;
                this.currentInterval = 'hourly';
                this.currentCrypto = 'bitcoin';
                this.chart = null;
                this.modalChart = null;
                this.updateInterval = null;
                this.cryptoData = {};
                
                this.currencySymbols = {
                    'usd': '$',
                    'eur': '€',
                    'brl': 'R$'
                };

                this.cryptoLogos = {
                    'bitcoin': 'icons/bitcoin-btc-logo.png',
                    'ethereum': 'icons/ethereum-eth-logo.png',
                    'solana': 'icons/solana-sol-logo.png'
                };

                this.cryptoNames = {
                    'bitcoin': 'Bitcoin',
                    'ethereum': 'Ethereum',
                    'solana': 'Solana'
                };

                this.cryptoSymbols = {
                    'bitcoin': 'BTC',
                    'ethereum': 'ETH',
                    'solana': 'SOL'
                };

                this.initChart();
                this.initModalChart();
                this.setupEventListeners();
                this.startDataUpdate();
            }

            initChart() {
                const ctx = document.getElementById('priceChart').getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Preço',
                            data: [],
                            borderColor: '#f7931a',
                            backgroundColor: 'rgba(247, 147, 26, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#8fa8b2'
                                }
                            },
                            y: {
                                display: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#8fa8b2',
                                    callback: (value) => {
                                        return this.currencySymbols[this.currentCurrency] + 
                                               value.toLocaleString();
                                    }
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }

            initModalChart() {
                const ctx = document.getElementById('modalPriceChart').getContext('2d');
                this.modalChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Preço',
                            data: [],
                            borderColor: '#f7931a',
                            backgroundColor: 'rgba(247, 147, 26, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: '#8fa8b2',
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(26, 35, 50, 0.95)',
                                titleColor: '#ffffff',
                                bodyColor: '#8fa8b2',
                                borderColor: '#f7931a',
                                borderWidth: 1,
                                callbacks: {
                                    label: (context) => {
                                        return 'Preço: ' + this.currencySymbols[this.currentCurrency] + 
                                               context.parsed.y.toLocaleString();
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#8fa8b2',
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            y: {
                                display: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#8fa8b2',
                                    font: {
                                        size: 12
                                    },
                                    callback: (value) => {
                                        return this.currencySymbols[this.currentCurrency] + 
                                               value.toLocaleString();
                                    }
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
            }

            setupEventListeners() {
                // Currency buttons
                document.querySelectorAll('[data-currency]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-currency]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentCurrency = e.target.dataset.currency;
                        this.updateData();
                    });
                });

                // Period buttons
                document.querySelectorAll('[data-period]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-period]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentPeriod = parseFloat(e.target.dataset.period);
                        this.updateChartData();
                    });
                });

                // Interval buttons
                document.querySelectorAll('[data-interval]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-interval]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentInterval = e.target.dataset.interval;
                        this.updateChartData();
                    });
                });

                // Crypto selector
                document.getElementById('cryptoSelector').addEventListener('change', (e) => {
                    this.currentCrypto = e.target.value;
                    this.updateCurrentCrypto();
                    this.updateChartData();
                });

                // Modal close on ESC key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        closeChartModal();
                    }
                });
            }

            async fetchCryptoData() {
                try {
                    const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=${this.currentCurrency}&include_24hr_change=true&include_24hr_vol=true&include_market_cap=true`);
                    const data = await response.json();
                    this.cryptoData = data;
                    return data;
                } catch (error) {
                    console.error('Erro ao buscar dados:', error);
                    return null;
                }
            }

            async fetchChartData(crypto, days, interval = null) {
                try {
                    let intervalParam = interval || this.currentInterval;
                    if (days >= 30) {
                        intervalParam = 'daily';
                    } else if (days <= 1) {
                        intervalParam = 'hourly';
                    }

                    const response = await fetch(`https://api.coingecko.com/api/v3/coins/${crypto}/market_chart?vs_currency=${this.currentCurrency}&days=${days}&interval=${intervalParam}`);
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Erro ao buscar dados do gráfico:', error);
                    return null;
                }
            }

            formatPrice(price) {
                const symbol = this.currencySymbols[this.currentCurrency];
                if (price >= 1000000) {
                    return symbol + (price / 1000000).toFixed(2) + 'M';
                } else if (price >= 1000) {
                    return symbol + (price / 1000).toFixed(2) + 'K';
                } else {
                    return symbol + price.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }
            }

            formatLargeNumber(num) {
                const symbol = this.currencySymbols[this.currentCurrency];
                if (num >= 1000000000000) {
                    return symbol + (num / 1000000000000).toFixed(2) + 'T';
                } else if (num >= 1000000000) {
                    return symbol + (num / 1000000000).toFixed(2) + 'B';
                } else if (num >= 1000000) {
                    return symbol + (num / 1000000).toFixed(2) + 'M';
                } else {
                    return symbol + num.toLocaleString();
                }
            }

            updatePriceDisplay(crypto, price, change) {
                const priceElement = document.getElementById(crypto + 'Price');
                const changeElement = document.getElementById(crypto + 'Change');
                
                if (priceElement && changeElement) {
                    priceElement.textContent = this.formatPrice(price);
                    changeElement.textContent = change.toFixed(2) + '%';
                    changeElement.className = 'price-change ' + (change >= 0 ? 'positive' : 'negative');
                }
            }

            updateCurrentCrypto() {
                const crypto = this.currentCrypto;
                const name = this.cryptoNames[crypto];
                const symbol = this.cryptoSymbols[crypto];
                const logo = this.cryptoLogos[crypto];

                document.getElementById('currentCryptoName').textContent = name;
                document.getElementById('currentCryptoSymbol').textContent = symbol;
                document.getElementById('currentCryptoIcon').src = logo;

                // Update modal elements too
                document.getElementById('modalCryptoName').textContent = name;
                document.getElementById('modalCryptoSymbol').textContent = symbol;
                document.getElementById('modalCryptoIcon').src = logo;

                if (this.cryptoData[crypto]) {
                    const data = this.cryptoData[crypto];
                    const price = this.formatPrice(data[this.currentCurrency]);
                    document.getElementById('currentPrice').textContent = price;
                    document.getElementById('modalCurrentPrice').textContent = price;
                    
                    const change = data[this.currentCurrency + '_24h_change'];
                    const changeElement = document.getElementById('priceChange');
                    changeElement.textContent = change.toFixed(2) + '%';
                    changeElement.className = 'price-change ' + (change >= 0 ? 'positive' : 'negative');

                    document.getElementById('volume24h').textContent = this.formatLargeNumber(data[this.currentCurrency + '_24h_vol']);
                    document.getElementById('marketCap').textContent = this.formatLargeNumber(data[this.currentCurrency + '_market_cap']);
                }
            }

            async updateData() {
                const data = await this.fetchCryptoData();
                if (data) {
                    // Update individual crypto cards
                    this.updatePriceDisplay('btc', data.bitcoin[this.currentCurrency], data.bitcoin[this.currentCurrency + '_24h_change']);
                    this.updatePriceDisplay('eth', data.ethereum[this.currentCurrency], data.ethereum[this.currentCurrency + '_24h_change']);
                    this.updatePriceDisplay('sol', data.solana[this.currentCurrency], data.solana[this.currentCurrency + '_24h_change']);
                    
                    // Update current crypto display
                    this.updateCurrentCrypto();
                    
                    // Update satoshi values
                    this.updateSatoshiValues();
                    
                    // Update timestamp
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleString('pt-BR');
                }
            }

            async updateChartData(isModal = false) {
                const loadingElement = isModal ? 'modalChartLoading' : 'chartLoading';
                const chart = isModal ? this.modalChart : this.chart;
                
                document.getElementById(loadingElement).style.display = 'block';
                
                const data = await this.fetchChartData(this.currentCrypto, this.currentPeriod);
                if (data && data.prices) {
                    const prices = data.prices;
                    const labels = prices.map(price => {
                        const date = new Date(price[0]);
                        if (this.currentPeriod <= 1) {
                            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                        } else if (this.currentPeriod <= 7) {
                            return date.toLocaleDateString('pt-BR', { 
                                month: 'short', 
                                day: 'numeric',
                                hour: this.currentInterval === 'hourly' ? '2-digit' : undefined
                            });
                        } else {
                            return date.toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' });
                        }
                    });
                    const values = prices.map(price => price[1]);

                    chart.data.labels = labels;
                    chart.data.datasets[0].data = values;
                    chart.update();
                }
                
                document.getElementById(loadingElement).style.display = 'none';
            }

            startDataUpdate() {
                this.updateData();
                this.updateChartData();
                
                // Update every 30 seconds
                this.updateInterval = setInterval(() => {
                    this.updateData();
                }, 30000);
                
                // Update chart every 2 minutes
                setInterval(() => {
                    this.updateChartData();
                }, 120000);
            }

            calculateConversion(fromAmount, fromCurrency, toCurrency) {
            if (!this.cryptoData || !fromAmount || fromAmount <= 0) {
                return 0;
            }

            const fiatCurrencies = ['usd', 'eur', 'brl'];
            const cryptoCurrencies = ['bitcoin', 'ethereum', 'solana'];
            
            let fromValueInUSD = 0;
            
            // Converter valor de origem para USD como base
            if (fiatCurrencies.includes(fromCurrency)) {
                if (fromCurrency === 'usd') {
                    fromValueInUSD = fromAmount;
                } else {
                    // Usar taxa de câmbio aproximada (em implementação real, use API de câmbio)
                    const exchangeRates = {
                        'eur': 1.1, // 1 EUR = 1.1 USD (aproximado)
                        'brl': 0.2  // 1 BRL = 0.2 USD (aproximado)
                    };
                    fromValueInUSD = fromAmount * exchangeRates[fromCurrency];
                }
            } else if (cryptoCurrencies.includes(fromCurrency)) {
                if (this.cryptoData[fromCurrency]) {
                    fromValueInUSD = fromAmount * this.cryptoData[fromCurrency].usd;
                }
            }
            
            // Converter de USD para moeda de destino
            if (fiatCurrencies.includes(toCurrency)) {
                if (toCurrency === 'usd') {
                    return fromValueInUSD;
                } else {
                    const exchangeRates = {
                        'eur': 0.91, // 1 USD = 0.91 EUR (aproximado)
                        'brl': 5.0   // 1 USD = 5.0 BRL (aproximado)
                    };
                    return fromValueInUSD * exchangeRates[toCurrency];
                }
            } else if (cryptoCurrencies.includes(toCurrency)) {
                if (this.cryptoData[toCurrency]) {
                    return fromValueInUSD / this.cryptoData[toCurrency].usd;
                }
            }
            
            return 0;
        }

        // Método para atualizar valores de satoshi
        updateSatoshiValues() {
            if (!this.cryptoData.bitcoin) return;
            
            const btcPrice = this.cryptoData.bitcoin;
            const satoshiInUSD = btcPrice.usd / 100000000;
            const satoshiInEUR = btcPrice.eur / 100000000;
            const satoshiInBRL = btcPrice.brl / 100000000;
            
            document.getElementById('satoshiValues').innerHTML = `
                <div><strong>USD:</strong> $${satoshiInUSD.toFixed(8)}</div>
                <div><strong>EUR:</strong> €${satoshiInEUR.toFixed(8)}</div>
                <div><strong>BRL:</strong> R$${satoshiInBRL.toFixed(8)}</div>
            `;
        }

        // Método para conversão BTC/Satoshi
        convertBtcSatoshi(value, direction) {
            if (!value || value <= 0) return 0;
            
            if (direction === 'btc-to-satoshi') {
                return Math.round(value * 100000000);
            } else {
                return value / 100000000;
            }
        }

        }

        // Global functions for modal
        function openChartModal() {
            document.getElementById('chartModal').classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Update modal chart with current data
            setTimeout(() => {
                dashboard.updateChartData(true);
            }, 100);
        }

        function closeChartModal() {
            document.getElementById('chartModal').classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        function setModalPeriod(days) {
            // Update active button
            document.querySelectorAll('.time-controls .btn-group:first-of-type .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update period and refresh chart
            dashboard.currentPeriod = days;
            dashboard.updateChartData(true);
        }

        function setModalInterval(interval) {
            // Update active button
            document.querySelectorAll('.time-controls .btn-group:last-of-type .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update interval and refresh chart
            dashboard.currentInterval = interval;
            dashboard.updateChartData(true);
        }

        // Global dashboard variable
        let dashboard;

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            dashboard = new CryptoDashboard();
            
            // Event listeners para o conversor geral
            document.getElementById('fromAmount').addEventListener('input', updateConversion);
            document.getElementById('fromCurrency').addEventListener('change', updateConversion);
            document.getElementById('toCurrency').addEventListener('change', updateConversion);
            
            // Event listeners para conversão BTC/Satoshi
            document.getElementById('btcAmount').addEventListener('input', () => updateBtcSatoshiConversion('btc'));
            document.getElementById('satoshiAmount').addEventListener('input', () => updateBtcSatoshiConversion('satoshi'));
        });

        // Close modal on click outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('chartModal');
            if (e.target === modal) {
                closeChartModal();
            }
        });
    
                // Função para trocar moedas no conversor
        function swapCurrencies() {
            const fromSelect = document.getElementById('fromCurrency');
            const toSelect = document.getElementById('toCurrency');
            
            const fromValue = fromSelect.value;
            const toValue = toSelect.value;
            
            fromSelect.value = toValue;
            toSelect.value = fromValue;
            
            updateConversion();
        }

        // Função para atualizar conversão em tempo real
        function updateConversion() {
            const fromAmount = parseFloat(document.getElementById('fromAmount').value);
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;
            
            if (!fromAmount || fromAmount <= 0) {
                document.getElementById('convertedAmount').textContent = 'Digite um valor';
                return;
            }
            
            const result = dashboard.calculateConversion(fromAmount, fromCurrency, toCurrency);
            const symbol = dashboard.currencySymbols[toCurrency] || '';
            
            if (result > 0) {
                if (['bitcoin', 'ethereum', 'solana'].includes(toCurrency)) {
                    document.getElementById('convertedAmount').textContent = result.toFixed(8);
                } else {
                    document.getElementById('convertedAmount').textContent = symbol + result.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }
            } else {
                document.getElementById('convertedAmount').textContent = 'Erro na conversão';
            }
        }

        // Função para conversão BTC/Satoshi
        function updateBtcSatoshiConversion(changedField) {
    const btcInput = document.getElementById('btcAmount');
    const satoshiInput = document.getElementById('satoshiAmount');
    const resultDiv = document.getElementById('satoshiResult');
    
    if (changedField === 'btc') {
        const btcValue = parseFloat(btcInput.value);
        if (btcValue && btcValue > 0) {
            const satoshiValue = dashboard.convertBtcSatoshi(btcValue, 'btc-to-satoshi');
            satoshiInput.value = satoshiValue;
            
            // Mostrar valor em moedas fiat
            if (dashboard.cryptoData.bitcoin) {
                const usdValue = btcValue * dashboard.cryptoData.bitcoin.usd;
                const eurValue = btcValue * dashboard.cryptoData.bitcoin.eur;
                const brlValue = btcValue * dashboard.cryptoData.bitcoin.brl;
                
                resultDiv.innerHTML = `
                    <div><strong>Valor:</strong></div>
                    <div>$${usdValue.toLocaleString()} | €${eurValue.toLocaleString()} | R$${brlValue.toLocaleString()}</div>
                `;
            }
        } else {
            satoshiInput.value = '';
            resultDiv.textContent = 'Digite valores para conversão';
        }
    } else if (changedField === 'satoshi') {
        const satoshiValue = parseFloat(satoshiInput.value);
        if (satoshiValue && satoshiValue > 0) {
            const btcValue = dashboard.convertBtcSatoshi(satoshiValue, 'satoshi-to-btc');
            btcInput.value = btcValue.toFixed(8);
            
            // Mostrar valor em moedas fiat
            if (dashboard.cryptoData.bitcoin) {
                const usdValue = btcValue * dashboard.cryptoData.bitcoin.usd;
                const eurValue = btcValue * dashboard.cryptoData.bitcoin.eur;
                const brlValue = btcValue * dashboard.cryptoData.bitcoin.brl;
                
                resultDiv.innerHTML = `
                    <div><strong>Valor:</strong></div>
                    <div>$${usdValue.toLocaleString()} | €${eurValue.toLocaleString()} | R$${brlValue.toLocaleString()}</div>
                `;
            }
        } else {
            btcInput.value = '';
            resultDiv.textContent = 'Digite valores para conversão';
        }
    }
}

    </script>
</body>
</html>